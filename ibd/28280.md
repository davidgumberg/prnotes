# [#28280](https://github.com/bitcoin/bitcoin/pull/28280) Don't empty dbcache on prune flushes: >30% faster IBD

## [refactor: encapsulate flags access for dirty and fresh checks](https://github.com/bitcoin/bitcoin/pull/28280/commits/0383defd049fa1feb6de7abea259041487ccda1d)

This commit refactors the checks for whether or not a `CCoinsCacheEntry` is fresh and dirty into methods `entry.IsDirty()` and `entry.IsFresh()`. This is in preparation for a future commit that makes the `flags` attribute of a coins cache entry private.

From `src/coins.h`:
```cpp
struct CCoinsCacheEntry
{
    /* ... */
    inline bool IsDirty() const noexcept { return flags & DIRTY; }
    inline bool IsFresh() const noexcept { return flags & FRESH; }
    /* ... */
};
```

and elsewhere:

```diff
 for (CCoinsMap::iterator it = mapCoins.begin(); it != mapCoins.end();) {
-    if (it->second.flags & CCoinsCacheEntry::DIRTY) {
+    if (it->second.IsDirty()) {
```

## [refactor: encapsulate flags get access for all other checks](https://github.com/bitcoin/bitcoin/pull/28280/commits/fc3501d14c27a0103650d6054c4027274b18ed4f)

This refactor commit adds a getter method `GetFlags()`:

```cpp
inline unsigned char GetFlags() const noexcept { return flags; }
```

In preparation for making `flags` a private attribute.


## Annotated code

<details>

<summary>

Placeholder summary

</summary>

```
```

</details> 
